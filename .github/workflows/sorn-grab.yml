name: Daily SORN update
on: workflow_dispatch
  # schedule:
  #   - cron: "11 7 * * *"  # Arbitrary time outside continental US office hours


jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - name: Install cf cli
        uses: ./.github/cf-cli
      - name: Login and update
        env:
          CF_USERNAME: ${{ secrets.CF_USERNAME }}
          CF_PASSWORD: ${{ secrets.CF_PASSWORD }}
          CF_ORG: ${{ secrets.CF_ORG }}
          CF_SPACE: ${{ secrets.CF_SPACE }}
          CF_CGHOSTNAME: test
        run: |
        cf api https://api.fr.cloud.gov
        cf auth "$CF_USERNAME" "$CF_PASSWORD"
        cf target -o "$CF_ORG" -s "$CF_SPACE"
        cf run-task all_sorns "bundle exec rails federal_register:find_sorns" --name "Daily SORN update"